<!DOCTYPE html>
<html lang="en">
  <head>
    <title>kermit</title>
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': true %>
    <%= csrf_meta_tags %>
    <meta charset="utf-8">
    <%= favicon_link_tag('favicon.png') %>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="logged_in" authenticated="<%= user_signed_in? %>" />
    <meta name="env" env="<%= Rails.env %>" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom">
      <div class="container-fluid">
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li>
              <%= link_to('Home', root_path) %>
            </li>
            <li>
              <%= link_to('Query editor', editor_path) %>
            </li>
            <% if current_user %>
              <li>
                <%= link_to(current_user.name, '#') %>
              </li>
              <li>
                <%= link_to "Logout", destroy_user_session_path, method: :delete  %>
              </li>
            <% else %>
              <li>
                <%= link_to 'Signup', new_user_registration_path %>
              </li>
              <li>
                <%= link_to 'Login', new_user_session_path %>
              </li>
            <% end %>
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
      <!-- /.container -->
    </nav>
      
      <div class="header <%= controller.controller_name == 'sections' && controller.action_name == 'index' ? 'header--fixed' : '' %>">
        <div class="logo">
          <a href="/">
          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          	 viewBox="0 0 555 195" enable-background="new 0 0 555 195" xml:space="preserve">
          <path d="M20.2,179c-1.4,0-2.4-1-2.4-2.4V18.2c0-1.4,1-2.4,2.4-2.4h61.2c31.7,0,53.8,20.4,53.8,50.6
          	c0,30.5-22.1,50.9-53.8,50.9H47.6c-1,0-1.4,0.5-1.4,1.4v57.8c0,1.4-1,2.4-2.4,2.4H20.2z M106.8,66.4c0-14.9-10.3-25.2-27.1-25.2
          	H47.6c-1,0-1.4,0.5-1.4,1.4v47.5c0,1,0.5,1.4,1.4,1.4h32.2C96.5,91.6,106.8,81.6,106.8,66.4z"/>
          <path d="M146.8,18.2c0-1.4,1-2.4,2.4-2.4h22.1c1.9,0,3.1,0.7,4.1,2.4l66.5,112.6h1V18.2c0-1.4,1-2.4,2.4-2.4h20.9
          	c1.4,0,2.4,1,2.4,2.4v158.4c0,1.4-1,2.4-2.4,2.4h-21.8c-1.9,0-3.1-0.7-4.1-2.4L173.5,64.3h-1v112.3c0,1.4-1,2.4-2.4,2.4h-20.9
          	c-1.4,0-2.4-1-2.4-2.4V18.2z"/>
          <path d="M458,18.2c0.5-1.4,1.4-2.4,3.1-2.4h22.1c1.7,0,2.6,1,3.1,2.4l55.2,158.4c0.5,1.4,0,2.4-1.7,2.4h-23.5
          	c-1.7,0-2.6-0.7-3.1-2.4l-10.8-31.7H441l-10.8,31.7c-0.5,1.7-1.4,2.4-3.1,2.4h-23.3c-1.7,0-2.2-1-1.7-2.4L458,18.2z M493.8,119.7
          	l-21.6-63.4h-0.7l-21.8,63.4H493.8z"/>
          <path d="M288.4,141.8c-3.4-10.3-4.3-18.2-4.3-44.4c0-26.2,1-34.1,4.3-44.4c8.4-26.4,28.6-39.8,56.2-39.8
          	c30.2,0,49.5,17.8,55.5,47.3c0.2,1.4-1,2.4-2.4,2.4h-22.8c-1.7,0-2.6-1-3.1-2.4c-4.3-12.7-12.5-21.8-27.2-21.8
          	c-14.9,0-24.5,8.4-28.8,21.6c-2.2,6.7-2.9,13-2.9,37.2c0,24.2,0.7,30.5,2.9,37.2c4.3,13.2,13.4,21.6,28.8,21.6
          	c15.1,0,23.1-10.7,27.7-24.2c0.5-1.4,1-2.4,2.4-2.4h23.5c1.4,0,2.6,1,2.4,2.4c-6,29.5-25.7,49.6-56,49.6
          	C317,181.6,296.8,168.2,288.4,141.8z"/>
          </svg>
        </a>
        
        
        
        
        
        </div>
          
          
       <% if controller.controller_name == 'sections' and controller.action_name == 'index' %> 
          
        <div class="toolbar__filters">
		 	 
          <div class="filter__selector">
  			   	 <a href="javascript:;" class="filter-trigger"><span class="filter-text filter__program" data-activefilter="<%= @program || 'UG' %>"><%= @program || 'UG' %></span> 
  			 	  	 <span class="arrow">&#9660;</span>
  				   </a>
  			   </div>
      
  			   <div class="filter__list poppable" style="display:none;">
  			     <ul>
               <% @programs.each do |p| %>
                 <li><a href="javascript:;" class="filter <%= 'filter__selected' if @program == p %>" data-func="filterPrograms" data-filterval="<%= p %>"><%= p %></a></li>
               <% end %>
   		       </ul>
  			   </div>
         
        </div>
          
         <div class="toolbar__filters">
 		 	 
           <div class="filter__selector">
   			   	 <a href="javascript:;" class="filter-trigger"><span class="filter-text filter__term" data-activefilter="<%= @term.semester %>,<%= @term.year %>"><%= @term.shorty %></span> 
   			 	  	 <span class="arrow">&#9660;</span>
   				   </a>
   			   </div>
       
   			   <div class="filter__list poppable" style="display:none;">
   			     <ul>
   			 	     <li><a href="javascript:;" class="filter <%= 'filter__selected' if @term.shorty == Term.current.previous.shorty %>" data-func="filterTerms" data-filterval="<%= Term.current.previous.semester %>,<%= Term.current.previous.year %>"><%= Term.current.previous.shorty %></a></li>
    			 	   <li><a href="javascript:;" class="filter <%= 'filter__selected' if @term.shorty == Term.current.shorty %>" data-func="filterTerms" data-filterval="<%= Term.current.semester %>,<%= Term.current.year %>"><%= Term.current.shorty %></a></li>
    				   <li><a href="javascript:;" class="filter <%= 'filter__selected' if @term.shorty == Term.current.next.shorty %>" data-func="filterTerms" data-filterval="<%= Term.current.next.semester %>,<%= Term.current.next.year %>"><%= Term.current.next.shorty %></a></li>
             </ul>
   			   </div>
          
         </div>
  
         <div class="instructor__filter">  
           <input type="text" class="instructor__query text-field" autocomplete="off" placeholder="Search by Instructor ..." data-uuid="<%= @instructor.uuid if @instructor %>" value="<%= @instructor.last_name if @instructor %>">
           
           <a href="javascript:;" class="clear-instructor" style="display:none;">x</a>

           <script>
           
             $('.instructor__query').autocomplete({
               width: 250,
               minChars: 2,
               delimiter: /(,|;)\s*/,
               onSearchStart: function() {
                 $('.container').css('opacity','0.3');
               },
               onSelect: function(suggestion) {
                 $('.container').css('opacity','1');
                 $('.clear-instructor').hide();

                 var program = $('.filter__program').data('activefilter');

                 var filter_term = $('.filter__term').data('activefilter').split(','),
                   term = filter_term[0],
                   year = filter_term[1];

                 var path = '/p/'+program+'/t/'+term+'/y/'+year+'/i/'+suggestion.data;
                 
                 Turbolinks.visit(path);
                 $('.spins').show();
                 
               },
               onHide: function() {
                 $('.clear-instructor').hide();
               },
               autoSelectFirst: true,
               lookup: <%= @all_instructors.to_json.html_safe %>
             }).on('focus', function(e) {
               $('.clear-instructor').show();
             }).on('blur', function(e) {
               $('.container').css('opacity','1');
             });
             
             $('.clear-instructor').on('click', function(e) {
               $('.instructor__query').val('');
               $('.container').css('opacity','1');
               $('.clear-instructor').hide();

               var program = $('.filter__program').data('activefilter');

               var filter_term = $('.filter__term').data('activefilter').split(','),
                 term = filter_term[0],
                 year = filter_term[1];

               var path = '/p/'+program+'/t/'+term+'/y/'+year;
               
               Turbolinks.visit(path);
               $('.spins').show();
               
             });
             
             $(".filter-trigger").on('click', function(e) {
               $(this).parent().next('.filter__list').show();
             });
 
             $(".filter").on('click', function(e) {
            	 var fil = $(this).html(), d = $(this).data();
  
               $(this).addClass('filter__selected').siblings().removeClass('filter__selected');
               $(this).closest('.toolbar__filters').find('.filter-text').html(fil);
      
               $(this).closest('.filter__list').hide();
               $('.spins').show();
               
               var fnname = d.func,
                   fn = window[fnname]; 
               
               if (typeof fn === "function") fn.apply(null, [d]);
               
              });
              
              
            var ready = function() {
              $('.spins').hide();
              
            };
            $(document).on('page:load', ready);
            
           
            function filterTerms(data) {
              var program = $('.filter__program').data('activefilter');
              
              var filter_term = data.filterval.split(','),
                term = filter_term[0],
                year = filter_term[1];
           
              var path = '/p/'+program+'/t/'+term+'/y/'+year;
 
              if ($('.instructor__query').data('uuid') != '') {
                path += '/i/'+ $('.instructor__query').data('uuid'); 
              }
           
              Turbolinks.visit(path);
            }
           
            function filterPrograms(data) {
              
              var program = data.filterval;
           
              var filter_term = $('.filter__term').data('activefilter').split(','),
                term = filter_term[0],
                year = filter_term[1];
             
              var path = '/p/'+program+'/t/'+term+'/y/'+year;
 
              if ($('.instructor__query').data('uuid') != '') {
                path += '/i/'+ $('.instructor__query').data('uuid'); 
              }
           
              Turbolinks.visit(path);
            }
           
           
              
           </script>
         </div>

       <% end %>     
       
       
       
       <div class="spins" style="display:none;">
           <svg xmlns="http://www.w3.org/2000/svg" xlink:xlink="http://www.w3.org/1999/xlink" class="tributary_svg">
             <g transform="translate(70,20)"><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(30)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.10666666666666667s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(60)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.21333333333333335s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(90)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.32s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(120)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.4266666666666667s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(150)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.5333333333333333s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(180)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.64s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(210)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.7466666666666667s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(240)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.8533333333333334s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(270)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="0.9600000000000001s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(300)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="1.0666666666666667s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(330)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="1.1733333333333333s"></animate></line><line fill="none" stroke-linecap="round" stroke-width="2.5" x1="4" y1="4" x2="12" y2="12" stroke="#09bcff" transform="rotate(360)"><animate attributeName="opacity" repeatCount="indefinite" attributeType="CSS" from="1" to="0.3" dur="1.28s" begin="1.28s"></animate></line>
             </g>
           </svg>
         </div>
       
       
       
        
     </div>
   
    
     <% flash.each do |key, value| %>
       <%#= content_tag :div, value, class: "flash #{key} flashnotice" unless value.blank? %>
     <% end %>      
      
     <div class="container" style="<%= controller.controller_name == 'sections' && controller.action_name == 'index' ? 'padding-top:120px' : '' %>"">
      	<%= yield %>    
     </div>
      


  </body>
</html>
